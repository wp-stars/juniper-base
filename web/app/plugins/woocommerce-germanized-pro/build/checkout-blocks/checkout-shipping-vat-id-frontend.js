"use strict";(self.webpackWcGzdProBlocksJsonp=self.webpackWcGzdProBlocksJsonp||[]).push([[487],{599:function(e,t,a){a.r(t),a.d(t,{default:function(){return r}});var o=a(196),s=a(947),n=a(307),r=({children:e,checkoutExtensionData:t,extensions:a,cart:r})=>((0,n.useEffect)((()=>{const e=document.getElementsByClassName("wp-block-woocommerce-checkout-shipping-address-block")[0],t=e.getElementsByClassName("wc-gzd-shipping-vat-id")[0];let a=e.getElementsByClassName("wc-block-components-address-form")[0];a||(a=e.getElementsByClassName("wc-block-components-address-form-wrapper")[0]),a.appendChild(t)}),[]),(0,o.createElement)(o.Fragment,null,(0,o.createElement)("div",{className:"wc-gzd-vat-id-element-placeholder"}),(0,o.createElement)("div",{className:"wc-gzd-vat-id wc-gzd-shipping-vat-id"},(0,o.createElement)(s.O,{cart:r,extensions:a,checkoutExtensionData:t,addressType:"shipping"}))))},947:function(e,t,a){a.d(t,{O:function(){return E}});var o=a(196),s=a(307),n=a(554),r=a(378),i=a(818),c=a(801),d=a(989),p=a.n(d),l=a(736);const m=(e,t)=>{const a=(0,r.getSetting)("postcodeVatExempts");let o=!1;return a.hasOwnProperty(e)?a[e].forEach((e=>{new RegExp("^"+e.replace("*","(.*)")).test(t)&&(o=!0)})):"GB"===e&&(o=!0,/^BT(.*)/.test(t)&&(o=!1)),o},g=e=>{const t=(0,r.getSetting)("countryData",{})[e];return t&&t.locale&&t.locale.hasOwnProperty("vat_id")?t.locale.vat_id:null},u=(e,t)=>{const a=g(e);let o=!1;return a&&(o=!a.hidden&&a.required),m(e,t)&&(o=!1),o},E=({checkoutExtensionData:e,extensions:t,cart:a,addressType:r,isEditor:d=!1})=>{const E=t.hasOwnProperty("woocommerce-germanized-pro")?t["woocommerce-germanized-pro"]:{},_=E.hasOwnProperty(`${r}_vat_id`)?E[`${r}_vat_id`]:"",h="shipping"===r?a.shippingAddress:a.billingAddress,y=h.country,v=h.postcode,[w,A]=(0,s.useState)(_),[f,S]=(0,s.useState)(!1),[T,O]=(0,s.useState)(y),{setExtensionData:C,extensionData:D}=e,{setValidationErrors:b,clearValidationError:z}=(0,i.useDispatch)(c.VALIDATION_STORE_KEY),k=`${r}_vat_id`,I=!!d||((e,t,a)=>{const o=g(e),s=(0,i.useSelect)((e=>e(c.VALIDATION_STORE_KEY).getValidationError(`${a}_postcode`)));return!(o&&o.hidden||m(e,t)||!t||s)})(y,v,r),V=a.cartNeedsShipping?"shipping"===r:"billing"===r,{useShippingAsBilling:B}=(0,i.useSelect)((e=>({useShippingAsBilling:e(c.CHECKOUT_STORE_KEY).getUseShippingAsBilling()})));(0,s.useEffect)((()=>{if(B)C("woocommerce-germanized-pro","billing_vat_id",""),a.cartNeedsShipping||(0,n.extensionCartUpdate)({namespace:"woocommerce-germanized-pro-vat-id",data:{vat_id:"",address_type:"billing"}});else if("billing"===r){const e=D.hasOwnProperty("woocommerce-germanized-pro")?D["woocommerce-germanized-pro"]:{},t=e.hasOwnProperty("shipping_vat_id")?e.shipping_vat_id:"";t&&x(t)}}),[B,r]),(0,i.useSelect)((e=>e(c.VALIDATION_STORE_KEY).getValidationError(k)));const{isCustomerDataUpdating:N}=(0,i.useSelect)((e=>({isCustomerDataUpdating:e(c.CART_STORE_KEY).isCustomerDataUpdating()})));(0,s.useEffect)((()=>{C("woocommerce-germanized-pro",`${r}_vat_id`,w)}),[w]),(0,s.useEffect)((()=>{!I||h.country!==T&&!N?(O(h.country),A("")):w&&R.current?.revalidate()}),[h.postcode,h.city,h.company,h.country,A,I,O]);const x=(0,s.useCallback)((e=>{if(A(e),!(0,i.select)(c.VALIDATION_STORE_KEY).getValidationError(k)&&!N){S(!0);const t={vat_id:e,postcode:h.postcode,city:h.city,country:h.country,company:h.company,address_type:r};p()({path:"/wc/store/v1/cart/update-vat-id",method:"POST",data:t,cache:"no-store",parse:!1}).then((t=>{p().setNonce(t.headers),t.json().then((function(a){t.ok?z(k):a.body&&a.body.message?b({[k]:{message:a.body.message,hidden:!1}}):b({[k]:{message:(0,l.__)("An error occurred while validating your vat id. Please try again.","woocommerce-germanized-pro"),hidden:!1}}),S(!1),V&&(0,n.extensionCartUpdate)({namespace:"woocommerce-germanized-pro-vat-id",data:{vat_id:e,address_type:r}})}))})).catch((t=>{t.json().then((function(e){b({[k]:{message:e.message,hidden:!1}})})),S(!1),V&&(0,n.extensionCartUpdate)({namespace:"woocommerce-germanized-pro-vat-id",data:{vat_id:e,address_type:r}})}))}}),[A,k,N,S,V,b,z]),P={id:`${r}-vat-id`,errorId:k,label:(0,l.__)("VAT ID","woocommerce-germanized-pro"),errorMessage:"",required:u(h.country,h.postcode),className:`wc-block-components-address-form__${r}_vat_id`,disabled:f},R=(0,s.useRef)(null);return I?(0,o.createElement)(n.ValidatedTextInput,{ref:R,key:P.id,value:w,...P,onChange:x,customFormatter:e=>(e=e.toUpperCase()).replace(/[^\w\.]/g,""),customValidation:e=>!e.value||(!!/^(ATU[0-9]{8}|BE[01][0-9]{9}|BG[0-9]{9,10}|HR[0-9]{11}|CY[A-Z0-9]{9}|CZ[0-9]{8,10}|DK[0-9]{8}|EE[0-9]{9}|FI[0-9]{8}|FR[0-9A-Z]{2}[0-9]{9}|DE[0-9]{9}|EL[0-9]{9}|HU[0-9]{8}|IE([0-9]{7}[A-Z]{1,2}|[0-9][A-Z][0-9]{5}[A-Z])|IT[0-9]{11}|LV[0-9]{11}|LT([0-9]{9}|[0-9]{12})|LU[0-9]{8}|MT[0-9]{8}|NL[0-9]{9}B[0-9]{2}|PL[0-9]{10}|PT[0-9]{9}|RO[0-9]{2,10}|SK[0-9]{10}|SI[0-9]{8}|ES(([A-Z])([0-9]{7})([A-Z]|[0-9])|([0-9])([0-9]{7})([A-Z]))|SE[0-9]{12}|GB([0-9]{9}|[0-9]{12}|GD[0-4][0-9]{2}|HA[5-9][0-9]{2}))$/.test(e.value)||(e.setCustomValidity((0,l.__)("The VAT ID you've provided is not correct.","woocommerce-germanized-pro")),!1))}):null}}}]);